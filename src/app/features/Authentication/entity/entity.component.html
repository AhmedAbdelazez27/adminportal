<div class="container-fluid">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="title">{{ 'ENTITY.TITLE' | translate }}</h1>
    <button class="btn btn-gold" data-bs-toggle="modal" data-bs-target="#Entity" (click)="openAddModal()">
      {{ 'ENTITY.ADD_NEW' | translate }}
    </button>
  </div>

  <div class="filter mb-3">
    <div class="d-flex justify-content-between align-items-center">
      <h4 class="filter-title mb-0">{{ 'Common.SearchTitle' | translate }}</h4>
      <button class="btn btn-filter" type="button" data-bs-toggle="collapse" data-bs-target="#collapseExample"
              aria-expanded="false" aria-controls="collapseExample">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
          <path d="M17.7499 6.31657H13.0999C12.7749 6.31657 12.5166 6.05824 12.5166 5.73324C12.5166 5.40824 12.7749 5.1499 13.0999 5.1499H17.7499C18.0749 5.1499 18.3333 5.40824 18.3333 5.73324C18.3333 6.05824 18.0749 6.31657 17.7499 6.31657Z"
                fill="" />
          <path d="M5.35033 6.31657H2.25033C1.92533 6.31657 1.66699 6.05824 1.66699 5.73324C1.66699 5.40824 1.92533 5.1499 2.25033 5.1499H5.35033C5.67533 5.1499 5.93366 5.40824 5.93366 5.73324C5.93366 6.05824 5.66699 6.31657 5.35033 6.31657Z"
                fill="" />
          <path d="M8.44987 9.02523C10.2678 9.02523 11.7415 7.5515 11.7415 5.73356C11.7415 3.91562 10.2678 2.44189 8.44987 2.44189C6.63193 2.44189 5.1582 3.91562 5.1582 5.73356C5.1582 7.5515 6.63193 9.02523 8.44987 9.02523Z"
                fill="" />
          <path d="M17.7497 14.8415H14.6497C14.3247 14.8415 14.0664 14.5831 14.0664 14.2581C14.0664 13.9331 14.3247 13.6748 14.6497 13.6748H17.7497C18.0747 13.6748 18.3331 13.9331 18.3331 14.2581C18.3331 14.5831 18.0747 14.8415 17.7497 14.8415Z"
                fill="" />
          <path d="M6.90033 14.8415H2.25033C1.92533 14.8415 1.66699 14.5831 1.66699 14.2581C1.66699 13.9331 1.92533 13.6748 2.25033 13.6748H6.90033C7.22533 13.6748 7.48366 13.9331 7.48366 14.2581C7.48366 14.5831 7.21699 14.8415 6.90033 14.8415Z"
                fill="" />
          <path d="M11.5505 17.5584C13.3684 17.5584 14.8421 16.0847 14.8421 14.2668C14.8421 12.4488 13.3684 10.9751 11.5505 10.9751C9.73252 10.9751 8.25879 12.4488 8.25879 14.2668C8.25879 16.0847 9.73252 17.5584 11.5505 17.5584Z"
                fill="" />
        </svg>
      </button>
    </div>

    <div class="collapse" id="collapseExample">
      <div class="card card-body">
        <div class="row mb-3">
          <div class="col-xl-4 mb-3">
            <label for="searchName" class="form-label">{{ 'AuthenticationResorceName.searchName' | translate }}</label>
            <input type="text" class="form-control" id="searchName" placeholder="Search by Arabic or English name"
                   [(ngModel)]="searchValue">
          </div>
        </div>

        <div class="d-flex gap-2 justify-content-center">
          <button class="btn btn-outline" (click)="clear()">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
              <path d="M16.19 2H7.81C4.17 2 2 4.17 2 7.81V16.18C2 19.83 4.17 22 7.81 22H16.18C19.82 22 21.99 19.83 21.99 16.19V7.81C22 4.17 19.83 2 16.19 2ZM16 12.75H8C7.59 12.75 7.25 12.41 7.25 12C7.25 11.59 7.59 11.25 8 11.25H16C16.41 11.25 16.75 11.59 16.75 12C16.75 12.41 16.41 12.75 16 12.75Z"
                    fill="#5B5B5B" />
            </svg>
            Clear
          </button>
          <button class="btn btn-gold" (click)="onSearch()">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
              <path d="M16.19 2H7.81C4.17 2 2 4.17 2 7.81V16.18C2 19.83 4.17 22 7.81 22H16.18C19.82 22 21.99 19.83 21.99 16.19V7.81C22 4.17 19.83 2 16.19 2ZM16.78 9.7L11.11 15.37C10.97 15.51 10.78 15.59 10.58 15.59C10.38 15.59 10.19 15.51 10.05 15.37L7.22 12.54C6.93 12.25 6.93 11.77 7.22 11.48C7.51 11.19 7.99 11.19 8.28 11.48L10.58 13.78L15.72 8.64C16.01 8.35 16.49 8.35 16.78 8.64C17.07 8.93 17.07 9.4 16.78 9.7Z"
                    fill="white" />
            </svg>
            Apply
          </button>
        </div>
      </div>
    </div>
  </div>



  <!-- Entity Table -->
  <div *ngIf="isLoading" class="text-center py-4">
    <div class="spinner-border" role="status">
      <span class="visually-hidden">{{ 'AuthenticationResorceName.loading' | translate }}</span>
    </div>
  </div>

  <app-generic-data-table [columnDefs]="columnDefs"
                          [rowData]="loadgridData"
                          [totalCount]="pagination.totalCount"
                          [pageSize]="pagination.take"
                          [currentPage]="pagination.currentPage - 1"
                          [columnHeaderMap]="columnHeaderMap"
                          [rowActions]="rowActions"
                          (actionClick)="onTableAction($event)"
                          (pageChange)="onPageChange($event)"
                          [showActionColumn]="true"
                          (search)="onTableSearch($event)">
  </app-generic-data-table>
</div>

<!-- Entity Modal -->
<div class="modal fade" id="Entity" tabindex="-1" aria-labelledby="EntityLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="EntityLabel">
          {{ mode === 'add' ? ('ENTITY.ADD_NEW' | translate) : mode === 'edit' ? ('ENTITY.EDIT' | translate) :
          ('ENTITY.VIEW' | translate) }}
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <form [formGroup]="entityForm" (ngSubmit)="submit()">
        <div class="modal-body">
          <!-- Validation Summary -->
          <div class="alert alert-danger" *ngIf="hasFormErrors()">
            <div class="d-flex align-items-center">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="me-2"
                viewBox="0 0 16 16">
                <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z" />
                <path
                  d="M7.002 11a1 1 0 1 1 2 0 1 1 0 0 1-2 0zM7.1 4.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 4.995z" />
              </svg>
              <strong>{{ 'VALIDATION.FORM_ERRORS' | translate }}</strong>
              <span class="ms-2">{{ getTotalErrors() }} {{ 'VALIDATION.ERROR_COUNT' | translate }}</span>
            </div>
          </div>

          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="entitY_NAME" class="form-label">
                {{ 'ENTITY.ARABIC_NAME' | translate }} *
              </label>
              <input type="text" class="form-control" id="entitY_NAME" formControlName="entitY_NAME" maxlength="4000"
                [class.is-invalid]="isFieldInvalid('entitY_NAME')" [class.is-valid]="isFieldValid('entitY_NAME')"
                placeholder="{{ 'ENTITY.ENTER_ARABIC_NAME' | translate }}" (blur)="onFieldBlur('entitY_NAME')">
              <div class="invalid-feedback" *ngIf="isFieldInvalid('entitY_NAME')">
                {{ getFieldError('entitY_NAME') }}
              </div>
              <div class="valid-feedback" *ngIf="isFieldValid('entitY_NAME')">
                {{ 'VALIDATION.LOOKS_GOOD' | translate }}
              </div>
            </div>
            <div class="col-md-6 mb-3">
              <label for="entitY_NAME_EN" class="form-label">
                {{ 'ENTITY.ENGLISH_NAME' | translate }} *
              </label>
              <input type="text" class="form-control" id="entitY_NAME_EN" formControlName="entitY_NAME_EN"
                maxlength="4000" [class.is-invalid]="isFieldInvalid('entitY_NAME_EN')"
                [class.is-valid]="isFieldValid('entitY_NAME_EN')"
                placeholder="{{ 'ENTITY.ENTER_ENGLISH_NAME' | translate }}" (blur)="onFieldBlur('entitY_NAME_EN')">
              <div class="invalid-feedback" *ngIf="isFieldInvalid('entitY_NAME_EN')">
                {{ getFieldError('entitY_NAME_EN') }}
              </div>
              <div class="valid-feedback" *ngIf="isFieldValid('entitY_NAME_EN')">
                {{ 'VALIDATION.LOOKS_GOOD' | translate }}
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="entitY_LOCALTION" class="form-label">
                {{ 'ENTITY.LOCATION' | translate }}
              </label>
              <input type="text" class="form-control" id="entitY_LOCALTION" formControlName="entitY_LOCALTION"
                maxlength="4000" [class.is-invalid]="isFieldInvalid('entitY_LOCALTION')"
                [class.is-valid]="isFieldValid('entitY_LOCALTION')"
                placeholder="{{ 'ENTITY.ENTER_LOCATION' | translate }}" (blur)="onFieldBlur('entitY_LOCALTION')">
              <div class="invalid-feedback" *ngIf="isFieldInvalid('entitY_LOCALTION')">
                {{ getFieldError('entitY_LOCALTION') }}
              </div>
              <div class="valid-feedback" *ngIf="isFieldValid('entitY_LOCALTION')">
                {{ 'VALIDATION.LOOKS_GOOD' | translate }}
              </div>
            </div>
            <div class="col-md-6 mb-3">
              <label for="entitY_PHONE" class="form-label">
                {{ 'ENTITY.PHONE' | translate }}
              </label>
              <input type="tel" class="form-control" id="entitY_PHONE" formControlName="entitY_PHONE" maxlength="100"
                [class.is-invalid]="isFieldInvalid('entitY_PHONE')" [class.is-valid]="isFieldValid('entitY_PHONE')"
                placeholder="{{ 'ENTITY.ENTER_PHONE' | translate }}" (blur)="onFieldBlur('entitY_PHONE')">
              <div class="invalid-feedback" *ngIf="isFieldInvalid('entitY_PHONE')">
                {{ getFieldError('entitY_PHONE') }}
              </div>
              <div class="valid-feedback" *ngIf="isFieldValid('entitY_PHONE')">
                {{ 'VALIDATION.LOOKS_GOOD' | translate }}
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="entitY_WEBSITE" class="form-label">
                {{ 'ENTITY.WEBSITE' | translate }}
              </label>
              <input type="url" class="form-control" id="entitY_WEBSITE" formControlName="entitY_WEBSITE"
                maxlength="100" [class.is-invalid]="isFieldInvalid('entitY_WEBSITE')"
                [class.is-valid]="isFieldValid('entitY_WEBSITE')" placeholder="{{ 'ENTITY.ENTER_WEBSITE' | translate }}"
                (blur)="onFieldBlur('entitY_WEBSITE')">
              <div class="invalid-feedback" *ngIf="isFieldInvalid('entitY_WEBSITE')">
                {{ getFieldError('entitY_WEBSITE') }}
              </div>
              <div class="valid-feedback" *ngIf="isFieldValid('entitY_WEBSITE')">
                {{ 'VALIDATION.LOOKS_GOOD' | translate }}
              </div>
            </div>
            <div class="col-md-6 mb-3">
              <label for="entitY_MAIL" class="form-label">
                {{ 'ENTITY.EMAIL' | translate }}
              </label>
              <input type="email" class="form-control" id="entitY_MAIL" formControlName="entitY_MAIL" maxlength="100"
                [class.is-invalid]="isFieldInvalid('entitY_MAIL')" [class.is-valid]="isFieldValid('entitY_MAIL')"
                placeholder="{{ 'ENTITY.ENTER_EMAIL' | translate }}" (blur)="onFieldBlur('entitY_MAIL')">
              <div class="invalid-feedback" *ngIf="isFieldInvalid('entitY_MAIL')">
                {{ getFieldError('entitY_MAIL') }}
              </div>
              <div class="valid-feedback" *ngIf="isFieldValid('entitY_MAIL')">
                {{ 'VALIDATION.LOOKS_GOOD' | translate }}
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="acC_DETAILS_ID" class="form-label">
                {{ 'ENTITY.ACCOUNT_DETAILS' | translate }}
              </label>
              <ng-select id="acC_DETAILS_ID" formControlName="acC_DETAILS_ID" [items]="accountDetailsOptions"
                bindLabel="text" bindValue="id" [placeholder]="'ENTITY.SELECT_ACCOUNT_DETAILS' | translate"
                [clearable]="true" [searchable]="true" [class.is-invalid]="isFieldInvalid('acC_DETAILS_ID')"
                [class.is-valid]="isFieldValid('acC_DETAILS_ID')">
              </ng-select>
              <div class="invalid-feedback" *ngIf="isFieldInvalid('acC_DETAILS_ID')">
                {{ getFieldError('acC_DETAILS_ID') }}
              </div>
              <div class="valid-feedback" *ngIf="isFieldValid('acC_DETAILS_ID')">
                {{ 'VALIDATION.LOOKS_GOOD' | translate }}
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer" *ngIf="mode !== 'view'">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
            {{ 'COMMON.CANCEL' | translate }}
          </button>
          <button type="submit" class="btn btn-gold" [disabled]="submitted || !areMandatoryFieldsValid()">
            {{ mode === 'add' ? ('COMMON.CREATE' | translate) : ('COMMON.UPDATE' | translate) }}
          </button>
        </div>
        <div class="modal-footer" *ngIf="mode === 'view'">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
            {{ 'COMMON.CLOSE' | translate }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteEntityModal" tabindex="-1" aria-labelledby="deleteEntityModalLabel"
  aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="deleteEntityModalLabel">{{ 'COMMON.CONFIRM' | translate }} {{ 'COMMON.DELETE' |
          translate }}</h5>
        <button type="button" class="btn-close btn-delete" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p>{{ 'ENTITY.DELETE_CONFIRMATION' | translate }}</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary btn-delete" data-bs-dismiss="modal">
          {{ 'COMMON.CANCEL' | translate }}
        </button>
        <button type="button" class="btn btn-danger" (click)="deleteEntity()">
          {{ 'COMMON.DELETE' | translate }}
        </button>
      </div>
    </div>
  </div>
</div>
