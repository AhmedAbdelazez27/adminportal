<div class="main-wrapper">

  <app-navbar data-html2canvas-ignore="true"></app-navbar>


  <div class="page-content">
    <!-- <app-export-toolbar data-html2canvas-ignore="true" [captureFullPage]="true" fileName="charts"></app-export-toolbar> -->

    <div class="offcanvas offcanvas-end" data-bs-scroll="true"  tabindex="-1" id="offcanvasScrolling" aria-labelledby="offcanvasScrollingLabel">
      <div class="offcanvas-header">
        <h5 class="offcanvas-title bold gold" id="offcanvasScrollingLabel" id="offcanvasExampleLabel">{{ 'NOTIFICATIONS.TITLE' | translate }}</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close">
           <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
            <path d="M16.19 2H7.81C4.17 2 2 4.17 2 7.81V16.18C2 19.83 4.17 22 7.81 22H16.18C19.82 22 21.99 19.83 21.99 16.19V7.81C22 4.17 19.83 2 16.19 2ZM15.36 14.3C15.65 14.59 15.65 15.07 15.36 15.36C15.21 15.51 15.02 15.58 14.83 15.58C14.64 15.58 14.45 15.51 14.3 15.36L12 13.06L9.7 15.36C9.55 15.51 9.36 15.58 9.17 15.58C8.98 15.58 8.79 15.51 8.64 15.36C8.35 15.07 8.35 14.59 8.64 14.3L10.94 12L8.64 9.7C8.35 9.41 8.35 8.93 8.64 8.64C8.93 8.35 9.41 8.35 9.7 8.64L12 10.94L14.3 8.64C14.59 8.35 15.07 8.35 15.36 8.64C15.65 8.93 15.65 9.41 15.36 9.7L13.06 12L15.36 14.3Z" fill="#5B5B5B"/>
          </svg>
        </button>
      </div>
      <div class="offcanvas-body">

        <!-- Header -->
        <div class="d-flex align-items-center gap-3 mb-3">
          <button class="btn-notification-action" (click)="refreshNotifications()" [disabled]="loading" title="">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
              <path d="M21.1674 8C19.6242 4.46819 16.1001 2 11.9994 2C6.8141 2 2.55055 5.94668 2.04883 11"
                stroke="#374957" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
              <path d="M17 8H21.4C21.7314 8 22 7.73137 22 7.4V3" stroke="#374957" stroke-width="1.5"
                stroke-linecap="round" stroke-linejoin="round" />
              <path d="M2.88086 16C4.42398 19.5318 7.94814 22 12.0488 22C17.2341 22 21.4977 18.0533 21.9994 13"
                stroke="#374957" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
              <path d="M7.04883 16H2.64883C2.31746 16 2.04883 16.2686 2.04883 16.6V21" stroke="#374957"
                stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
            {{ 'NOTIFICATIONS.REFRESH' | translate }}
          </button>
          <button class="btn-notification-action" (click)="markAllAsSeen()" *ngIf="unseenCount > 0" title="">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
              <path d="M1.5 12.5L5.57574 16.5757C5.81005 16.8101 6.18995 16.8101 6.42426 16.5757L9 14" stroke="#374957"
                stroke-width="1.5" stroke-linecap="round" />
              <path d="M16 7L12 11" stroke="#374957" stroke-width="1.5" stroke-linecap="round" />
              <path d="M7 12L11.5757 16.5757C11.8101 16.8101 12.1899 16.8101 12.4243 16.5757L22 7" stroke="#374957"
                stroke-width="1.5" stroke-linecap="round" />
            </svg>
            {{ 'NOTIFICATIONS.MARK_ALL_READ' | translate }}
          </button>
        </div>

        <!-- Loading State -->
        <div class="dropdown-loading" *ngIf="loading">
          <div class="d-flex align-items-center justify-content-center py-3">
            <div class="spinner-border spinner-border-sm me-2" role="status"></div>
            <span>{{ 'NOTIFICATIONS.LOADING' | translate }}</span>
          </div>
        </div>





        <!-- Notifications List -->
        <div class="notifications-list" *ngIf="!loading">
          <div class="notification-item"
            *ngFor="let notification of (notifications || []); trackBy: trackByNotificationId"
            [class.unread]="!notification.isSeen" (click)="markAsSeen(notification)">

            <div class="notification-content">
              <div class="notification-title">
                {{ getNotificationTitle(notification) }}
              </div>

              <div class="notification-time">
                {{ formatDate(notification.notificationDate) }}
              </div>
            </div>
            <div class="notification-message">
              {{ getNotificationMessage(notification) }}
            </div>

            <div class="notification-indicator" *ngIf="!notification.isSeen">
              <div class="unread-dot"></div>
            </div>
          </div>

          <!-- Empty State -->
          <div class="empty-state" *ngIf="!notifications || notifications.length === 0">
            <i class="fas fa-bell-slash fa-2x text-muted mb-2"></i>
            <p class="text-muted mb-0">{{ 'NOTIFICATIONS.NO_NOTIFICATIONS' | translate }}</p>
          </div>
        </div>

        <!-- Footer -->
        <!-- <div class="dropdown-footer" *ngIf="notifications && notifications.length > 0">
          <button class="btn btn-gold w-100" data-bs-dismiss="offcanvas" aria-label="Close">
            {{ 'NOTIFICATIONS.VIEW_ALL' | translate }}
          </button>
        </div> -->
        <div class="dropdown-footer" *ngIf="notifications && notifications.length > 0">
            <button class="btn btn-gold w-100" (click)="onViewAllNotifications()" data-bs-dismiss="offcanvas"
                aria-label="Close">
                {{ 'NOTIFICATIONS.VIEW_ALL' | translate }}
            </button>
        </div>

      </div>
    </div>



    <router-outlet></router-outlet>

  </div>
</div>